(this["webpackJsonpdemo-dfsu"]=this["webpackJsonpdemo-dfsu"]||[]).push([[0],{111:function(e,t){},136:function(e,t){},146:function(e,t){},149:function(e,t){},179:function(e,t,n){},180:function(e,t,n){},184:function(e,t,n){"use strict";n.r(t);var r=n(12),a=n(10),s=n.n(a),i=n(88),o=n.n(i),c=(n(179),n(122)),u=(n(180),n(209)),l=(n(217),n(208),n(4)),f=n(2),d=n(1),h=n(34),v=n(98),p=n(205),m=n(210),b=n(3),g=n(15),x=n(14),j=n(6),y=n(7),_=n(105),O=n(77),B=n(145),w=n(148),S=n(154),k=n(155),T=n(204),C=function(e){return"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nstruct ColorBand {\n  float value;\n  vec4 color;\n};\n\nattribute vec3 positions;\nattribute float dfs_values_a;\nattribute float dfs_values_b;\n\nvarying float dfs_value_a;\nvarying float dfs_value_b;\n\nvoid main(void) {\n  dfs_value_a = dfs_values_a;\n  dfs_value_b = dfs_values_b;\n  vec3 center = project_position(positions);\n  // center.z = center.z + dfs_value_a * 0.001;\n  gl_Position = project_common_position_to_clipspace(vec4(center, 1.0));\n}\n"},A=function(e){return"\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nstruct ColorBand {\n  float value;\n  vec4 color;\n};\n\nvarying float dfs_value_a;\nvarying float dfs_value_b;\n\nuniform ColorBand colorBands[".concat(e,"];\nuniform float screenWidth;\nuniform float mouseX;\n\nvec4 valueToColor(float value) {\n  vec4 outColor = vec4(0.0);\n  for (int i = 0; i < ").concat(e,"; ++i) {\n    float interpolatePt = (value - colorBands[i].value) / (colorBands[i+1].value - colorBands[i].value);\n    outColor = mix(colorBands[i].color, colorBands[i+1].color, interpolatePt);\n\n    if (value <= colorBands[i+1].value) {\n      break;\n    }\n  }\n  return outColor;\n}\n\nvoid main(void) {\n  float mousePosX = (screenWidth - (screenWidth - mouseX));\n\n  if (gl_FragCoord.x > mousePosX) {\n    gl_FragColor = valueToColor(dfs_value_a);\n  } else {\n    gl_FragColor = valueToColor(dfs_value_b);\n  }\n}\n")},D=0;window.addEventListener("mousemove",(function(e){D=e.x,e.y}));var L=function(e){Object(j.a)(n,e);var t=Object(y.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"getShaders",value:function(){var e=this.props.colorPoints.length,t=C(e),r=A(e);return Object(g.a)(Object(x.a)(n.prototype),"getShaders",this).call(this,{vs:t,fs:r,modules:[O.a,B.a,w.a]})}},{key:"initializeState",value:function(){var e=this,t=!0;this.getAttributeManager().add({positions:{size:3,type:_.a.FLOAT,fp64:this.use64bitPositions(),update:function(t){return t.value=e.state.mesh.positions},noAlloc:t},dfs_values_a:{size:1,type:_.a.FLOAT,update:function(t){return t.value=e.state.mesh.dfs_values_a},noAlloc:t},dfs_values_b:{size:1,type:_.a.FLOAT,update:function(t){return t.value=e.state.mesh.dfs_values_b},noAlloc:t}});var n=this._createMesh();this.setState(Object(b.a)({mesh:n},this._getCoordinateUniforms()))}},{key:"updateState",value:function(e){var t=e.props,n=e.oldProps;if(e.changeFlags.extensionsChanged){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}var a=this.getAttributeManager();if(t.dfsValuesBufferA!==n.dfsValuesBufferA||t.dfsValuesBufferB!==n.dfsValuesBufferB){var s=this._createMesh();a.invalidate("dfs_values_a"),a.invalidate("dfs_values_b"),this.setState({mesh:s})}t.colorPoints!==n.colorPoints&&this.getShaders(),t._imageCoordinateSystem!==n._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}},{key:"disablePickingIndex",value:function(){this.setState({disablePicking:!0})}},{key:"restorePickingColors",value:function(){this.setState({disablePicking:!1})}},{key:"_createMesh",value:function(){var e=this.props,t=e.verticesBuffer,n=e.dfsValuesBufferA,r=e.dfsValuesBufferB;return{vertexCount:t.length/3,positions:t,dfs_values_a:n,dfs_values_b:r}}},{key:"_getModel",value:function(e){return e?new k.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new T.a({drawMode:_.a.TRIANGLES,vertexCount:this.props.verticesBuffer.length/3}),isInstanced:!1})):null}},{key:"draw",value:function(e){var t=e.uniforms,n=e.moduleParameters,r=this.state,a=r.model,s=r.disablePicking;if(!n.pickingActive||!s){var i={};this.props.colorPoints.forEach((function(e,t){i["colorBands[".concat(t,"].value")]=e.value,i["colorBands[".concat(t,"].color")]=F(e.color)}));var o={screenWidth:window.innerWidth,mouseX:D};a&&a.setUniforms(Object(b.a)(Object(b.a)({uniforms:t},i),o)).draw()}}},{key:"_getCoordinateUniforms",value:function(){return{coordinateConversion:0}}}]),n}(S.a),F=function(e){return e.includes("rgba(")?I(e):E(e)},I=function(e){var t=e.replace(" ","").replace("rgba(","").replace(")","").split(",");return[parseInt(t[0])/255,parseInt(t[1])/255,parseInt(t[2])/255,Math.round(255*parseFloat(t[3]))/255]},E=function(e){var t=e.replace(" ","").replace("rgb(","").replace(")","").split(",");return[parseInt(t[0])/255,parseInt(t[1])/255,parseInt(t[2])/255,1]};L.layerName="BinaryGridLayer",v.d({useWebWorkers:!1});var P=function(){function e(){Object(f.a)(this,e),this.isLoaded=void 0,this.binaryDfsuLayer=void 0,this.verticesBuffer=void 0,this.colorAttributeBuffers=void 0,this.colorAttributeBufferEmpty=void 0,this._currentTimestepIndex=void 0,this.timestepDateTimes=void 0,this.minDFSValue=void 0,this.maxDFSValue=void 0,this.legendScale=void 0,this.mouseX=void 0,this.mouseY=void 0,this.fetchAnalysisTimesteps=Object(h.c)(Object(l.a)().mark((function e(){var t,n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("./timesteps.zip",{method:"GET",headers:{Accept:"application/x-zip-compressed"}});case 3:return t=e.sent,e.next=6,t.blob();case 6:return n=e.sent,e.abrupt("return",n);case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),this.retrieveTimeSteps=Object(h.c)(Object(l.a)().mark((function e(){var t;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchAnalysisTimesteps();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this.extractDataFromBlob(t);case 7:this.currentTimestepIndex=0,this.renderDfsuLayer(),this.isLoaded=!0;case 10:case"end":return e.stop()}}),e,this)}))),this.extractDataFromBlob=Object(h.c)(Object(l.a)().mark((function e(t){var n,r,a,s,i,o,c,u,f,d=this;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new v.c(new v.a(t)),e.next=3,n.getEntries();case 3:if(!(r=e.sent).length){e.next=27;break}return a=r.findIndex((function(e){return"vertices.bin"===e.filename})),e.next=8,this.zipEntryToBuffer(r,a);case 8:return s=e.sent,i=r.findIndex((function(e){return"stats.json"===e.filename})),e.next=12,this.zipEntryToJSON(r,i);case 12:o=e.sent,this.timestepDateTimes=o.dateTimes.map((function(e){return new Date(e)})),c=[],u=Object(l.a)().mark((function e(t){var n,a,s;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.findIndex((function(e){return e.filename==="".concat(t,".bin")})),e.next=3,d.zipEntryToBuffer(r,n);case 3:a=e.sent,s=d.dfsValuesToColorBuffer(a),c.push(s),0===t&&(d.colorAttributeBufferEmpty=new Float32Array(s.length));case 7:case"end":return e.stop()}}),e)})),f=0;case 17:if(!(f<r.length-2)){e.next=22;break}return e.delegateYield(u(f),"t0",19);case 19:++f,e.next=17;break;case 22:this.verticesBuffer=s,this.colorAttributeBuffers=c,this.minDFSValue=0,this.maxDFSValue=12,this.legendScale=this.generateLegendColorPoints();case 27:return e.next=29,n.close();case 29:case"end":return e.stop()}}),e,this)}))),this.zipEntryToBuffer=Object(h.c)(Object(l.a)().mark((function e(t,n){var r,a,s;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[n],e.next=3,r.getData(new v.b);case 3:return a=e.sent,e.next=6,a.arrayBuffer();case 6:return s=e.sent,e.abrupt("return",new Float32Array(s));case 8:case"end":return e.stop()}}),e)}))),this.zipEntryToJSON=Object(h.c)(Object(l.a)().mark((function e(t,n){var r,a,s,i;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[n],e.next=3,r.getData(new v.b);case 3:return a=e.sent,e.next=6,a.text();case 6:return s=e.sent,i=JSON.parse(s),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)}))),Object(h.e)(this),this.binaryDfsuLayer=null,this.verticesBuffer=null,this.colorAttributeBuffers=[],this.timestepDateTimes=[],this._currentTimestepIndex=-1,this.colorAttributeBufferEmpty=null,this.isLoaded=!1,this.minDFSValue=0,this.maxDFSValue=0,this.legendScale=[],this.mouseX=0,this.mouseY=0}return Object(d.a)(e,[{key:"currentTimestepIndex",get:function(){return this._currentTimestepIndex},set:function(e){this._currentTimestepIndex=e,e>=0&&this.renderDfsuLayer()}},{key:"renderDfsuLayer",value:function(){var e,t;t=-1!==(e=this.isLoaded?this.currentTimestepIndex:0)?this.colorAttributeBuffers[e]:this.colorAttributeBufferEmpty;for(var n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=t[r]/3;this.binaryDfsuLayer=new L({id:"Example Binary Grid Layer",verticesBuffer:this.verticesBuffer,dfsValuesBufferA:t,dfsValuesBufferB:n,colorPoints:Object(h.i)(this.legendScale),parameters:{depthTest:!1}})}},{key:"dfsValuesToColorBuffer",value:function(e){for(var t=new Float32Array(3*e.length),n=0,r=0;r<e.length;++r){var a=e[r];t[n++]=a,t[n++]=a,t[n++]=a}return t}},{key:"generateLegendColorPoints",value:function(){for(var e=0,t=[1,2,5,10,15,20,25,50,100,150,200,250,300,400,500,1e3,2e3,5e3,1e4,2e4,25e3,5e4,1e5,2e5,25e4,5e5];e<t.length;){var n=t[e],r=Math.floor(this.minDFSValue/n);if(!(Math.ceil(this.maxDFSValue/n)+1-r>10))break;e++}for(var a=t[e],s=[],i=Math.floor(this.minDFSValue/a),o=Math.ceil(this.maxDFSValue/a)+1,c=Object(m.a)().domain([i,.25*(i+o),.5*(i+o),.75*(i+o),o]).range(["#211fccaa","#438ba1cc","#edea37cc","#eb9c2fcc","#c91818cc"]).interpolate(p.a),u=i;u<o;++u){var l=u*a;s.push({value:l,color:c(u),label:"".concat(l)})}return s}},{key:"updateMouse",value:function(e,t){this.mouseX=e,this.mouseY=t}}]),e}(),V=Object(a.createContext)(void 0);function M(){var e;return null!==(e=Object(a.useContext)(V))&&void 0!==e?e:function(){throw new Error("RootStoreReactContext missing.")}()}var z=n(212),W=n(206),X=n(39),R=Object(c.a)((function(){var e=M().legendScale;return Object(X.jsx)(z.a,{width:"15ch",children:e.map((function(e){return Object(X.jsxs)(z.a,{children:[Object(X.jsx)(z.a,{display:"inline-block",width:"0.8rem",height:"0.8rem",mr:1,style:{backgroundColor:e.color}}),Object(X.jsx)(W.a,{variant:"overline",component:"span",children:e.label})]},e.label)}))})})),N=n(215),G={longitude:153.126,latitude:-27.4105,zoom:11,pitch:0,bearing:0},J=Object(c.a)((function(){var e=M();s.a.useEffect((function(){e.retrieveTimeSteps()}),[e]),s.a.useEffect((function(){var t=0,n=t,r=setInterval((function(){var r=performance.now(),a=r-n;n=r,t+=a;var s=e.timestepDateTimes.length-1,i=e.currentTimestepIndex;e.currentTimestepIndex=i<s&&-1!==i?i+1:-1}),40);return function(){return clearInterval(r)}}),[e]);var t=[];return e.isLoaded&&e.binaryDfsuLayer&&t.push(e.binaryDfsuLayer),Object(X.jsxs)("div",{style:{backgroundColor:"#0f0f0f"},children:[Object(X.jsx)(u.a,{initialViewState:G,controller:!0,layers:t,_animate:!0}),e.isLoaded&&Object(X.jsx)(z.a,{position:"absolute",left:"1rem",top:"1rem",borderRadius:"0.5rem",p:2,style:{backgroundColor:"white"},children:Object(X.jsx)(R,{})}),!e.isLoaded&&Object(X.jsx)(z.a,{position:"absolute",left:"1rem",top:"1rem",borderRadius:"0.5rem",minWidth:"20ch",p:2,style:{backgroundColor:"white"},children:Object(X.jsx)(W.a,{children:"Loading..."})}),e.isLoaded&&Object(X.jsx)(z.a,{position:"absolute",left:"50%",bottom:"1rem",borderRadius:"0.5rem",minWidth:"50ch",p:2,style:{backgroundColor:"white",transform:"translateX(-50%)"},children:Object(X.jsx)(N.a,{value:e.currentTimestepIndex>0?e.currentTimestepIndex:0,min:0,max:e.timestepDateTimes.length-1,onChange:function(t,n){e.currentTimestepIndex=n}})})]})})),U=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,221)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),s(e),i(e)}))};function Y(){var e=s.a.useState(new P),t=Object(r.a)(e,2),n=t[0];t[1];return Object(X.jsx)(s.a.StrictMode,{children:Object(X.jsx)(V.Provider,{value:n,children:Object(X.jsx)(J,{})})})}o.a.render(Object(X.jsx)(Y,{}),document.getElementById("root")),U()}},[[184,1,2]]]);
//# sourceMappingURL=main.39c5e2fd.chunk.js.map